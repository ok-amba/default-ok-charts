suite: Ingress host tests
templates:
- "ingress.yaml"
tests:
# NOTE: The reason we do not have asserts in the first test, like the rest is because we need to put the host test into the template itself.

  - it: "Should set the correct cluster-issuer and ingressClass for public okdc.dk"
    set:
      service.enable: true
      deployment.container.containerPort: 8080
      ingress.enable: true
      ingress:
        isPrivate: true
        host: "example.private.okdc.dk"
    asserts:
      - equal:
          path: "spec.ingressClassName"
          value: "nginx-private"  # Expected value based on ingressClassName
      - equal:
          path: "metadata.annotations['cert-manager.io/cluster-issuer']"
          value: "clouddns-dns01-issuer"

  - it: "Should set the correct cluster-issuer and ingressClass for public okdc.dk"
    set:
      service.enable: true
      deployment.container.containerPort: 8080
      ingress.enable: true
      ingress:
        host: "example.test.okdc.dk"
    asserts:
      - equal:
          path: "spec.ingressClassName"
          value: "nginx-public"  # Expected value based on ingressClassName
      - equal:
          path: "metadata.annotations['cert-manager.io/cluster-issuer']"
          value: "clouddns-dns01-issuer"

  - it: "Should set the correct cluster-issuer and ingressClass for private okcloud.dk"
    set:
      service.enable: true
      deployment.container.containerPort: 8080
      ingress.enable: true
      ingress:
        host: "example.test.okcloud.dk"
    asserts:
      - equal:
          path: "spec.ingressClassName"
          value: "nginx"  # Expected value based on ingressClassName
      - equal:
          path: "metadata.annotations['cert-manager.io/cluster-issuer']"
          value: "nginx-http01"

  - it: "Should set ingressClass if defined and not add nginx annotations by default"
    set:
      service.enable: true
      deployment.container.containerPort: 8080
      ingress.enable: true
      ingress:
        host: "example.test.okcloud.dk"
        ingressClassName: emob-charging-station-haproxy
    asserts:
      - equal:
          path: "spec.ingressClassName"
          value: "emob-charging-station-haproxy"  # Expected value based on ingressClassName
      - notExists:
          path: "metadata.annotations['cert-manager.io/cluster-issuer']"
