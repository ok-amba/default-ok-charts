suite: Cloud SQL Proxy External Secret test
templates: 
  - cloudsql-external-secret.yaml
tests:
  - it: "Should create one secret"
    set:
      deployment.cloudSQLProxy:
        enable: true
        instanceName: sqlinstance-name
        secretKeyName: sql-service-account
    asserts:
      - hasDocuments:
          count: 1
  - it: "Should create no secret"
    set:
      deployment.cloudSQLProxy:
        enable: true
        instanceName: sqlinstance-name
    asserts:
      - hasDocuments:
          count: 0        
  - it: "Should create no secret"
    set:
      deployment.cloudSQLProxy:
        enable: false
        instanceName: sqlinstance-name
        secretKeyName: sql-service-account
    asserts:
      - hasDocuments:
          count: 0        
  